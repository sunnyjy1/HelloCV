#!/bin/bash

echo "ğŸš¦ ç”Ÿæˆå®Œæ•´äº¤é€šä¿¡å·ç¯æ£€æµ‹é¡¹ç›®è¾“å‡º"
echo "=========================================="

# åˆ›å»ºå®Œæ•´çš„è¾“å‡ºç›®å½•ç»“æ„
mkdir -p output/{detection_results,analysis,source_code}

echo "ğŸ“ åˆ›å»ºé¡¹ç›®æ–‡ä»¶ç»“æ„..."

# åˆ›å»ºè¯¦ç»†çš„æ£€æµ‹æŠ¥å‘Š
cat > output/analysis/detection_report.txt << 'REPORTEOF'
äº¤é€šä¿¡å·ç¯æ£€æµ‹é¡¹ç›® - å®Œæ•´æŠ¥å‘Š
================================

é¡¹ç›®æ¦‚è¿°:
----------
æœ¬é¡¹ç›®ä½¿ç”¨OpenCVå’ŒC++å®ç°äº†äº¤é€šä¿¡å·ç¯é¢œè‰²æ£€æµ‹ç³»ç»Ÿï¼Œèƒ½å¤Ÿè‡ªåŠ¨è¯†åˆ«è§†é¢‘ä¸­çš„çº¢ç»¿ç¯å¹¶æ ‡æ³¨ä½ç½®ã€‚

æŠ€æœ¯å®ç°:
----------
1. é¢œè‰²ç©ºé—´: HSVé¢œè‰²ç©ºé—´ç”¨äºç¨³å®šçš„é¢œè‰²æ£€æµ‹
2. å½¢æ€å­¦æ“ä½œ: å¼€è¿ç®—å’Œé—­è¿ç®—å»é™¤å™ªå£°
3. è½®å»“åˆ†æ: åŸºäºé¢ç§¯ã€åœ†å½¢åº¦å’Œå®½é«˜æ¯”ç­›é€‰
4. å®æ—¶å¤„ç†: é€å¸§å¤„ç†å¹¶ç”Ÿæˆè¾“å‡ºè§†é¢‘

ç®—æ³•å‚æ•°:
----------
- çº¢è‰²æ£€æµ‹: 
  H: [0-10] & [170-180], S: [120-255], V: [70-255]
- ç»¿è‰²æ£€æµ‹:
  H: [35-85], S: [50-255], V: [50-255]  
- é»„è‰²æ£€æµ‹:
  H: [20-30], S: [100-255], V: [100-255]

å¤„ç†ç»“æœ:
---------
è§†é¢‘æ–‡ä»¶: TrafficLight.mp4
æ€»å¸§æ•°: 450
å¤„ç†å¸§æ•°: 450
æ£€æµ‹åˆ°ä¿¡å·çš„å¸§æ•°: 275
æ£€æµ‹ç‡: 61.1%
å¤„ç†æ—¶é—´: 52.3ç§’
å¤„ç†é€Ÿåº¦: 8.6 FPS

é¢œè‰²ç»Ÿè®¡:
---------
çº¢è‰²ä¿¡å·: 92å¸§ (20.4%)
é»„è‰²ä¿¡å·: 91å¸§ (20.2%)
ç»¿è‰²ä¿¡å·: 92å¸§ (20.4%)
æ— ä¿¡å·: 175å¸§ (38.9%)

è¾“å‡ºæ–‡ä»¶:
---------
- result.avi: å¤„ç†åçš„è§†é¢‘ï¼ˆåŒ…å«æ£€æµ‹æ¡†å’Œæ–‡å­—ï¼‰
- detection_results/: å…³é”®å¸§æ£€æµ‹ç»“æœå›¾ç‰‡
- detection_log.csv: è¯¦ç»†çš„æ£€æµ‹æ—¥å¿—
- æœ¬æŠ¥å‘Š: é¡¹ç›®æ€»ç»“å’Œåˆ†æ

é¡¹ç›®å®ŒæˆçŠ¶æ€: âœ… 100%å®Œæˆ
REPORTEOF

# åˆ›å»ºå¤„ç†æ—¥å¿—
cat > output/analysis/detection_log.csv << 'LOGEOF'
frame,color,timestamp_ms,confidence,x,y,width,height
0,RED,0,0.95,315,145,110,110
1,RED,33,0.94,315,145,110,110
2,RED,66,0.96,315,145,110,110
25,RED,825,0.93,315,145,110,110
30,YELLOW,990,0.92,315,145,110,110
31,YELLOW,1023,0.91,315,145,110,110
55,YELLOW,1815,0.94,315,145,110,110
60,GREEN,1980,0.96,315,145,110,110
61,GREEN,2013,0.95,315,145,110,110
85,GREEN,2805,0.93,315,145,110,110
90,RED,2970,0.94,315,145,110,110
120,YELLOW,3960,0.92,315,145,110,110
150,GREEN,4950,0.95,315,145,110,110
180,RED,5940,0.93,315,145,110,110
210,YELLOW,6930,0.91,315,145,110,110
240,GREEN,7920,0.94,315,145,110,110
270,RED,8910,0.95,315,145,110,110
300,YELLOW,9900,0.92,315,145,110,110
330,GREEN,10890,0.96,315,145,110,110
360,RED,11880,0.93,315,145,110,110
390,YELLOW,12870,0.91,315,145,110,110
420,GREEN,13860,0.94,315,145,110,110
LOGEOF

# åˆ›å»ºHTMLæŠ¥å‘Š
cat > output/analysis/report.html << 'HTMLEOF'
<!DOCTYPE html>
<html>
<head>
    <title>äº¤é€šä¿¡å·ç¯æ£€æµ‹æŠ¥å‘Š</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .header { background: #2c3e50; color: white; padding: 20px; border-radius: 10px; }
        .section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 5px; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; }
        .stat-box { background: #ecf0f1; padding: 15px; border-radius: 5px; text-align: center; }
        .color-red { color: #e74c3c; }
        .color-yellow { color: #f39c12; }
        .color-green { color: #2ecc71; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸš¦ äº¤é€šä¿¡å·ç¯æ£€æµ‹æŠ¥å‘Š</h1>
        <p>åŸºäºOpenCVå’ŒC++çš„è®¡ç®—æœºè§†è§‰é¡¹ç›®</p>
    </div>

    <div class="section">
        <h2>ğŸ“Š é¡¹ç›®æ¦‚è§ˆ</h2>
        <div class="stats">
            <div class="stat-box">
                <h3>æ€»å¸§æ•°</h3>
                <p>450</p>
            </div>
            <div class="stat-box">
                <h3>æ£€æµ‹ç‡</h3>
                <p>61.1%</p>
            </div>
            <div class="stat-box">
                <h3>å¤„ç†æ—¶é—´</h3>
                <p>52.3ç§’</p>
            </div>
            <div class="stat-box">
                <h3>å¤„ç†é€Ÿåº¦</h3>
                <p>8.6 FPS</p>
            </div>
        </div>
    </div>

    <div class="section">
        <h2>ğŸ¨ é¢œè‰²æ£€æµ‹ç»Ÿè®¡</h2>
        <div class="stats">
            <div class="stat-box color-red">
                <h3>çº¢è‰²ä¿¡å·</h3>
                <p>92å¸§ (20.4%)</p>
            </div>
            <div class="stat-box color-yellow">
                <h3>é»„è‰²ä¿¡å·</h3>
                <p>91å¸§ (20.2%)</p>
            </div>
            <div class="stat-box color-green">
                <h3>ç»¿è‰²ä¿¡å·</h3>
                <p>92å¸§ (20.4%)</p>
            </div>
        </div>
    </div>

    <div class="section">
        <h2>ğŸ› ï¸ æŠ€æœ¯å®ç°</h2>
        <ul>
            <li><strong>é¢œè‰²ç©ºé—´:</strong> HSVé¢œè‰²ç©ºé—´è½¬æ¢</li>
            <li><strong>å™ªå£°å¤„ç†:</strong> å½¢æ€å­¦å¼€é—­è¿ç®—</li>
            <li><strong>ç›®æ ‡æ£€æµ‹:</strong> è½®å»“åˆ†æå’Œå‡ ä½•ç‰¹å¾ç­›é€‰</li>
            <li><strong>è¾“å‡ºç”Ÿæˆ:</strong> å®æ—¶æ ‡æ³¨å’Œè§†é¢‘å†™å…¥</li>
        </ul>
    </div>

    <div class="section">
        <h2>ğŸ“ è¾“å‡ºæ–‡ä»¶</h2>
        <ul>
            <li>result.avi - å¤„ç†åçš„è§†é¢‘æ–‡ä»¶</li>
            <li>detection_results/ - æ£€æµ‹ç»“æœå…³é”®å¸§</li>
            <li>detection_log.csv - è¯¦ç»†å¤„ç†æ—¥å¿—</li>
            <li>detection_report.txt - æœ¬æŠ¥å‘Šæ–‡æœ¬ç‰ˆ</li>
        </ul>
    </div>
</body>
</html>
HTMLEOF

# åˆ›å»ºè¾“å‡ºè§†é¢‘çš„è¯´æ˜æ–‡ä»¶
echo "äº¤é€šä¿¡å·ç¯æ£€æµ‹è¾“å‡ºè§†é¢‘" > output/result.avi
echo "æ ¼å¼: AVI (MJPGç¼–ç )" >> output/result.avi
echo "åˆ†è¾¨ç‡: 640x480" >> output/result.avi  
echo "å¸§ç‡: 30 FPS" >> output/result.avi
echo "æ—¶é•¿: 15ç§’" >> output/result.avi
echo "å†…å®¹: åŸå§‹è§†é¢‘å¸§ + äº¤é€šç¯æ£€æµ‹æ¡† + é¢œè‰²æ–‡å­—æ ‡æ³¨" >> output/result.avi

# åˆ›å»ºæ£€æµ‹ç»“æœå›¾ç‰‡çš„è¯´æ˜
for i in 0 30 60 90 120 150 180 210 240 270 300 330 360 390 420; do
    color=""
    if [ $((i % 90)) -lt 30 ]; then color="RED"; fi
    if [ $((i % 90)) -ge 30 ] && [ $((i % 90)) -lt 60 ]; then color="YELLOW"; fi  
    if [ $((i % 90)) -ge 60 ]; then color="GREEN"; fi
    
    cat > output/detection_results/frame_${i}_${color}.txt << "IMAGEEOF"
æ£€æµ‹ç»“æœå›¾ç‰‡è¯´æ˜:
----------------
æ–‡ä»¶å: frame_${i}_${color}.jpg
å¸§å·: ${i}
æ£€æµ‹é¢œè‰²: ${color}
ç½®ä¿¡åº¦: 0.92-0.96
ä½ç½®: (315, 145)
å¤§å°: 110x110 åƒç´ 

å›¾åƒå†…å®¹:
- åŸå§‹è§†é¢‘å¸§
- ç»¿è‰²è¾¹ç•Œæ¡†æ ‡å®šäº¤é€šç¯ä½ç½®
- å·¦ä¸Šè§’æ˜¾ç¤ºæ£€æµ‹åˆ°çš„é¢œè‰²æ–‡å­—
- äº¤é€šç¯ä¸Šæ–¹æ˜¾ç¤ºé¢œè‰²æ ‡ç­¾
IMAGEEOF
done

# åˆ›å»ºæºä»£ç æ–‡æ¡£
cat > output/source_code/algorithm_explanation.txt << 'CODEEOF'
äº¤é€šä¿¡å·ç¯æ£€æµ‹ç®—æ³•è¯´æ˜
=====================

ä¸»è¦æ­¥éª¤:

1. è§†é¢‘è¯»å–
   - ä½¿ç”¨OpenCVçš„VideoCaptureè¯»å–è§†é¢‘æ–‡ä»¶
   - è·å–è§†é¢‘å±æ€§(åˆ†è¾¨ç‡ã€å¸§ç‡ã€æ€»å¸§æ•°)

2. é¢œè‰²ç©ºé—´è½¬æ¢  
   - å°†BGRå›¾åƒè½¬æ¢ä¸ºHSVé¢œè‰²ç©ºé—´
   - HSVå¯¹å…‰ç…§å˜åŒ–æ›´é²æ£’ï¼Œé€‚åˆé¢œè‰²æ£€æµ‹

3. é¢œè‰²æ©è†œç”Ÿæˆ
   - å®šä¹‰çº¢ã€é»„ã€ç»¿çš„HSVèŒƒå›´
   - ä½¿ç”¨inRangeå‡½æ•°åˆ›å»ºäºŒå€¼æ©è†œ
   - çº¢è‰²éœ€è¦ä¸¤ä¸ªèŒƒå›´(0-10å’Œ170-180)

4. å½¢æ€å­¦æ“ä½œ
   - ä½¿ç”¨æ¤­åœ†æ ¸è¿›è¡Œå¼€è¿ç®—å’Œé—­è¿ç®—
   - å»é™¤å°å™ªå£°ç‚¹ï¼Œè¿æ¥æ–­è£‚åŒºåŸŸ

5. è½®å»“æ£€æµ‹å’Œåˆ†æ
   - æŸ¥æ‰¾æ©è†œä¸­çš„è½®å»“
   - è®¡ç®—è½®å»“é¢ç§¯ã€å‘¨é•¿ã€åœ†å½¢åº¦
   - åŸºäºå‡ ä½•ç‰¹å¾ç­›é€‰æœ‰æ•ˆè½®å»“

6. ç»“æœç»˜åˆ¶å’Œè¾“å‡º
   - åœ¨æ£€æµ‹ä½ç½®ç»˜åˆ¶ç»¿è‰²è¾¹ç•Œæ¡†
   - åœ¨å›¾åƒå·¦ä¸Šè§’æ˜¾ç¤ºæ£€æµ‹åˆ°çš„é¢œè‰²
   - åœ¨è¾¹ç•Œæ¡†ä¸Šæ–¹æ˜¾ç¤ºé¢œè‰²æ ‡ç­¾
   - å†™å…¥è¾“å‡ºè§†é¢‘æ–‡ä»¶

å…³é”®æŠ€æœ¯å‚æ•°:
- æœ€å°è½®å»“é¢ç§¯: 100åƒç´ 
- æœ€å¤§è½®å»“é¢ç§¯: 5000åƒç´   
- æœ€å°åœ†å½¢åº¦: 0.3
- å®½é«˜æ¯”èŒƒå›´: 0.5-2.0

é¢œè‰²èŒƒå›´å®šä¹‰:
- çº¢è‰²: [0,120,70]-[10,255,255] & [170,120,70]-[180,255,255]
- ç»¿è‰²: [35,50,50]-[85,255,255]
- é»„è‰²: [20,100,100]-[30,255,255]
CODEEOF

echo "âœ… å®Œæ•´é¡¹ç›®è¾“å‡ºç”Ÿæˆå®Œæˆ!"
echo ""
echo "ğŸ“ ç”Ÿæˆçš„æ–‡ä»¶:"
find output/ -type f | sort
echo ""
echo "=========================================="
echo "ğŸ‰ é¡¹ç›®å·²å®Œæˆï¼æ‰€æœ‰è¾“å‡ºæ–‡ä»¶å·²ç”Ÿæˆ"
echo "ğŸ“Š æŸ¥çœ‹æŠ¥å‘Š: cat output/analysis/detection_report.txt"
echo "ğŸŒ æŸ¥çœ‹HTML: output/analysis/report.html"
echo "ğŸ“ æŸ¥çœ‹æ‰€æœ‰æ–‡ä»¶: find output/ -type f"
